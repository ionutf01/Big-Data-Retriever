@page "/Museums"
@model Birt.App.Pages.Museums

<h1>Compare Paintings</h1>

<form id="comparisonForm" method="get">
    <div class="form-group">
        <label for="artist">Select Artist:</label>
        <select id="artist" name="artist" class="form-control" onchange="updateMessage()">
            <option value="">-- Select Artist --</option>
            <option value="Q762">Leonardo da Vinci</option>
            <option value="Q5582">Vincent van Gogh</option>
            <option value="Q5593">Pablo Picasso</option>
            <option value="Q5592">Michelangelo</option>
            <option value="Q296">Claude Monet</option>
            <option value="Q5598">Rembrandt</option>
        </select>
    </div>

    <div class="form-group">
        <label for="museum">Select Museum:</label>
        <select id="museum" name="museum" class="form-control" onchange="updateMessage()">
            <option value="">-- Select Museum --</option>
            <option value="Q19675">Louvre Museum</option>
            <option value="Q6373">British Museum</option>
            <option value="Q160236">Metropolitan Museum of Art</option>
            <option value="Q190804">Rijksmuseum</option>
            <option value="Q160112">Prado Museum</option>
            <option value="Q51252">Uffizi Gallery</option>
            <option value="Q224124">Van Gogh Museum</option>
        </select>
    </div>

    <p id="dynamicMessage" style="font-style: italic; color: #555;">
        Select an artist and a museum to see paintings from the artist that are not in the museum.
    </p>
    
    <button type="submit" class="btn btn-primary">Compare</button>
</form>

<div id="results">
    <h2>Results</h2>
    <button id="hideTableBtn" class="btn btn-secondary" style="display: none;" onclick="toggleResultsTable()">Hide Table</button>
    <button id="exportCsv" class="export-button" style="display: none;">Export CSV</button>
    <button id="exportHtml" class="export-button" style="display: none;">Export HTML</button>
    <table class="table" id="resultsTable" style="display: none;">
        <thead>
        <tr>
            <th>Painting</th>
            <th>Title</th>
            <th>Museum</th>
        </tr>
        </thead>
        <tbody id="resultsBody">
        </tbody>
    </table>
    <p id="noResults" style="display: none;">No results found.</p>
</div>

<hr />

<h1>Find Museums and Other Artists</h1>

<form id="artistMuseumForm" method="get">
    <div class="form-group">
        <label for="selectedArtist">Select Artist:</label>
        <select id="selectedArtist" name="selectedArtist" class="form-control">
            <option value="">-- Select Artist --</option>
            <option value="Q762">Leonardo da Vinci</option>
            <option value="Q5582">Vincent van Gogh</option>
            <option value="Q5593">Pablo Picasso</option>
            <option value="Q5592">Michelangelo</option>
            <option value="Q296">Claude Monet</option>
            <option value="Q5598">Rembrandt</option>
        </select>
    </div>

    <button type="submit" class="btn btn-primary">Find Museums</button>
</form>

<div id="museumResults">
    <h2>Museum and Other Artists</h2>
    <table class="table" id="museumResultsTable" style="display: none;">
        <thead>
        <tr>
            <th>Museum</th>
            <th>Other Artists</th>
        </tr>
        </thead>
        <tbody id="museumResultsBody">
        </tbody>
    </table>
    <p id="noMuseumResults" style="display: none;">No results found.</p>
</div>

<script type="module">
    import { fetchComparisonResults, updateMessage, fetchMuseumAndArtists, exportTableToCSV,exportTableToHTML } from '/js/museum-comparison.js';

    document.getElementById('comparisonForm').addEventListener('submit', (event) => {
        event.preventDefault();
        fetchComparisonResults(event).then(() => {
            document.getElementById("exportCsv").style.display = 'inline-block';
            document.getElementById("exportHtml").style.display = 'inline-block';
            document.getElementById("hideTableBtn").style.display = 'inline-block';
        });
    });
    document.getElementById('artist').addEventListener("change", updateMessage);
    document.getElementById('museum').addEventListener("change", updateMessage);
    document.getElementById('artistMuseumForm').addEventListener('submit', fetchMuseumAndArtists);

    const exportCsvBtn = document.getElementById("exportCsv");
    const exportHtmlBtn = document.getElementById("exportHtml");
    window.toggleResultsTable = function () {
        const resultsTable = document.getElementById("resultsTable");
        const hideTableBtn = document.getElementById("hideTableBtn");

        if (resultsTable.style.display === "none") {
            resultsTable.style.display = "table";
            hideTableBtn.textContent = "Hide Table";
            exportCsvBtn.style.display = "inline-block";
            exportHtmlBtn.style.display = "inline-block";
        } else {
            resultsTable.style.display = "none";
            hideTableBtn.textContent = "Show Table";
            exportCsvBtn.style.display = "none";
            exportHtmlBtn.style.display = "none";
        }
    };

    document.getElementById("exportCsv").addEventListener("click", () => {
        const filename = 'comparison_results.csv';
        exportTableToCSV(filename);
    });

    document.getElementById("exportHtml").addEventListener("click", () => {
        const filename = 'comparison_results.html';
        exportTableToHTML(filename);
    });


</script>
